---

## üìÅ `measurement/`

–ú–æ–¥—É–ª—å `measurement` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è**, **–≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞** –∏ **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏** –ø—Ä–µ—Ñ–æ—Ä–º—ã. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç—É—Ä–∞–º–∏, –Ω–æ **–Ω–µ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –¥–µ—Ñ–µ–∫—Ç–æ–≤** (—ç—Ç–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–∞).

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ù–∞—á–∏–Ω–∞—è —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏, **–∫–æ–Ω—Ç—É—Ä –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è** –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –≥–æ—Ä–ª—ã—à–∫–∞ –≤–ø—Ä–∞–≤–æ. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è (`"neck_left"` / `"neck_right"`), –∏ —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–∏ –¥–Ω–∞.

---

### üìÑ `measurement/geometry.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞ –ø–æ –≥–ª–∞–≤–Ω–æ–π –æ—Å–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PCA –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏–Ω–∞—Ä–Ω–æ–π –º–∞—Å–∫–∏ –æ–±—ä–µ–∫—Ç–∞.

#### üîß –§—É–Ω–∫—Ü–∏–∏

*   **`align_contour(approx: np.ndarray, mask: np.ndarray) -> Tuple[np.ndarray, float, int, int, np.ndarray]`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—É—Ä –ø—Ä–µ—Ñ–æ—Ä–º—ã –ø–æ –µ–≥–æ –≥–ª–∞–≤–Ω–æ–π –æ—Å–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ PCA, –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω–æ–≥–æ –∫ –ø–∏–∫—Å–µ–ª—è–º –º–∞—Å–∫–∏. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è.
    *   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
        *   `approx` (np.ndarray): –ê–ø–ø—Ä–æ–∫—Å–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—É—Ä `(Nx1x2)`.
        *   `mask` (np.ndarray): –ë–∏–Ω–∞—Ä–Ω–∞—è –º–∞—Å–∫–∞ –æ–±—ä–µ–∫—Ç–∞ `(HxW)`.
    *   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
        *   `aligned_contour` ‚Äî –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—É—Ä `(Nx1x2)`,
        *   `angle_deg` ‚Äî —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö,
        *   `cx`, `cy` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞ –º–∞—Å–∫–∏,
        *   `rot_mat` ‚Äî –º–∞—Ç—Ä–∏—Ü–∞ –∞—Ñ—Ñ–∏–Ω–Ω–æ–≥–æ –ø–æ–≤–æ—Ä–æ—Ç–∞ `(2√ó3)` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–ª–æ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞.

> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è **–Ω–µ –∏–∑–º–µ—Ä—è–µ—Ç —Ä–∞–∑–º–µ—Ä—ã** –∏ **–Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é** ‚Äî —Ç–æ–ª—å–∫–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ –≥–ª–∞–≤–Ω–æ–π –æ—Å–∏.

---

### üìÑ `measurement/measuring_size.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ (L, Z) –∏ –¥–∏–∞–º–µ—Ç—Ä–∞ –¥–Ω–∞ (d1) –ø–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç—É—Ä—É —Å —É—á—ë—Ç–æ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏.

#### üîß –§—É–Ω–∫—Ü–∏–∏

*   **`get_extreme_points(aligned_approx: np.ndarray) -> Dict[str, Tuple[int, int]]`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—Ö–æ–¥–∏—Ç 4 –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ –∫–æ–Ω—Ç—É—Ä–∞: `leftmost`, `rightmost`, `topmost`, `bottommost`.
    *   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ª–æ–≤–∞—Ä—å —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Ç–æ—á–µ–∫.

*   **`measure_gabarits(aligned_approx: np.ndarray, pixels_per_mm: Optional[float] = None) -> Dict`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–∑–º–µ—Ä—è–µ—Ç **–¥–ª–∏–Ω—É (L)** –∏ **—à–∏—Ä–∏–Ω—É (Z)** –ø—Ä–µ—Ñ–æ—Ä–º—ã –ø–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç—É—Ä—É.
    *   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
        *   `aligned_approx` ‚Äî –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—É—Ä `(Nx1x2)`,
        *   `pixels_per_mm` ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
    *   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ª–æ–≤–∞—Ä—å —Å:
        - `extreme_points` ‚Äî –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–µ —Ç–æ—á–∫–∏,
        - `dimensions_px` ‚Äî —Ä–∞–∑–º–µ—Ä—ã –≤ –ø–∏–∫—Å–µ–ª—è—Ö (`L_px`, `Z_px`),
        - `dimensions_mm` ‚Äî —Ä–∞–∑–º–µ—Ä—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω `pixels_per_mm`).

*   **`measure_bottom_diameter(aligned_contour: np.ndarray, pixels_per_mm: Optional[float] = None, orientation: str = "neck_right") -> Dict`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–∑–º–µ—Ä—è–µ—Ç **–¥–∏–∞–º–µ—Ç—Ä –¥–Ω–∞ (d1)** –≤ –∑–æ–Ω–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –¥–Ω—É ‚Äî —Å–ª–µ–≤–∞ –ø—Ä–∏ `orientation="neck_right"` –∏ —Å–ø—Ä–∞–≤–∞ –ø—Ä–∏ `orientation="neck_left"`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–∏—Å–∫ –ø–µ—Ä–≤–æ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –¥–∏–∞–º–µ—Ç—Ä–∞ –≤ 15‚Äì25% –¥–ª–∏–Ω—ã –ø—Ä–µ—Ñ–æ—Ä–º—ã –æ—Ç –∫—Ä–∞—è –¥–Ω–∞.
    *   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
        *   `aligned_contour` ‚Äî –ø–ª–æ—Ç–Ω—ã–π –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—É—Ä `(Nx1x2)`,
        *   `pixels_per_mm` ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
        *   `orientation` ‚Äî `"neck_right"` (–¥–Ω–æ —Å–ª–µ–≤–∞) –∏–ª–∏ `"neck_left"` (–¥–Ω–æ —Å–ø—Ä–∞–≤–∞).
    *   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ª–æ–≤–∞—Ä—å —Å:
        - `bottom_points` ‚Äî —Ç–æ—á–∫–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è (`top_pt`, `bottom_pt`),
        - `x_level` ‚Äî X-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ —Å–µ—á–µ–Ω–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏—è,
        - `dimensions_px` ‚Äî `d1_px`,
        - `dimensions_mm` ‚Äî `d1_mm` (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω `pixels_per_mm`).

*   **`flip_contour_180(contour: np.ndarray, center_x: float, center_y: float) -> np.ndarray`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –∫–æ–Ω—Ç—É—Ä–∞ –Ω–∞ 180¬∞ –≤–æ–∫—Ä—É–≥ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞. **–í –æ—Å–Ω–æ–≤–Ω–æ–º pipeline –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**, –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –æ—Ç–ª–∞–¥–∫–∏.

---

### üìÑ `measurement/orientation.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–µ—Ñ–æ—Ä–º—ã (–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ä–ª—ã—à–∫–∞) **–±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–æ–Ω—Ç—É—Ä–∞**.

#### üîß –§—É–Ω–∫—Ü–∏–∏

*   **`determine_neck_orientation(extreme_points: dict, cx: float, cy: float, image_id: str = "unknown") -> str`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã—Ö —Ç–æ—á–µ–∫ (`topmost`, `bottommost`) –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—Å –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —Å –∫–∞–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≥–æ—Ä–ª—ã—à–∫–æ.
    *   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
        *   `extreme_points` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç `get_extreme_points`,
        *   `cx`, `cy` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—Å,
        *   `image_id` ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
    *   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
        - `"neck_right"` ‚Äî –≥–æ—Ä–ª—ã—à–∫–æ —Å–ø—Ä–∞–≤–∞ (–¥–Ω–æ —Å–ª–µ–≤–∞),
        - `"neck_left"` ‚Äî –≥–æ—Ä–ª—ã—à–∫–æ —Å–ª–µ–≤–∞ (–¥–Ω–æ —Å–ø—Ä–∞–≤–∞).

*   **`ensure_correct_orientation(...)`**
    *   **–°—Ç–∞—Ç—É—Å:** **–£—Å—Ç–∞—Ä–µ–≤—à–∞—è —Ñ—É–Ω–∫—Ü–∏—è**. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ **–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º pipeline** (`analyzer.py`). –†–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–æ–Ω—Ç—É—Ä–∞, –µ—Å–ª–∏ –≥–æ—Ä–ª—ã—à–∫–æ —Å–ª–µ–≤–∞.

*   **`apply_180_flip(contour: np.ndarray, cx: float, cy: float) -> np.ndarray`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 180¬∞. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ**, –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏–ª–∏ –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

---

### üìå –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π

- **–û—Ç–∫–∞–∑ –æ—Ç –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–æ–Ω—Ç—É—Ä–∞**: –≤–º–µ—Å—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏.
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –¥–Ω–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ**: –∑–æ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `orientation`, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å.
- **–£–ø—Ä–æ—â—ë–Ω–Ω—ã–π pipeline**: —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ —à–∞–≥–∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ª–æ–≥–∏–∫—É –±–æ–ª–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π.

---