
---

## üìÅ `analysis/`

–ú–æ–¥—É–ª—å `analysis` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –≤—Å–µ–≥–æ pipeline'–∞ –∞–Ω–∞–ª–∏–∑–∞**. –û–Ω –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–æ–¥—É–ª–µ–π –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏, –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ **–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∞–º—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ—Ñ–µ–∫—Ç–æ–≤**.

---

### üìÑ `analysis/analyzer.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ—Ñ–æ—Ä–º—ã.

#### üß± –ö–ª–∞—Å—Å `PreformGeometryAnalyzer`

*   **`__init__(self, logger=None, pixels_per_mm: float = 14.2, dimensions_data: Dict[str, Any] = None)`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.
    *   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
        *   `logger` (Logger, optional): –≠–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞.
        *   `pixels_per_mm` (float): –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ (–ø–∏–∫—Å–µ–ª–µ–π –Ω–∞ –º–∏–ª–ª–∏–º–µ—Ç—Ä).
        *   `dimensions_data` (Dict[str, Any]): –°–ª–æ–≤–∞—Ä—å —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–∏–ø–∞ –ø—Ä–µ—Ñ–æ—Ä–º—ã (–∏–∑ `preform_configs.json`).

*   **`analyze(self, img: np.ndarray, image_id: str = "unknown") -> Tuple[str, Dict, List]`**
    *   **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
    *   **–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**
        *   `img` (np.ndarray): –í—Ö–æ–¥–Ω–æ–µ BGR –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
        *   `image_id` (str): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ –∏–º—è —Ñ–∞–π–ª–∞).
    *   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ö–æ—Ä—Ç–µ–∂ –∏–∑ 3 —ç–ª–µ–º–µ–Ω—Ç–æ–≤:
        *   `verdict` (str): –°—Ç–∞—Ç—É—Å (`"–û—Ç–±—Ä–∞–∫–æ–≤–∞–Ω–æ"`, `"–û—à–∏–±–∫–∞"` –∏–ª–∏ `"–í –ø—Ä–æ—Ü–µ—Å—Å–µ"` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –¥–æ–ø—É—Å–∫–∞–º –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞).
        *   `measurements` (Dict): –°–ª–æ–≤–∞—Ä—å —Å –∏–∑–º–µ—Ä–µ–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ (`L_mm`, `Z_mm`, `d1_mm`, `straightness_deviation_mm`, `straightness_rms_mm` –∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö).
        *   `defects` (List): –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ (–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –æ—Ç–ª–æ–∂–µ–Ω–∞).

#### üîß –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∞ `analyze` (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —à–∞–≥–∏)

1.  **–®–ê–ì 1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `preprocessing.contour_detector.detect_contour`.
    ‚Üí –ï—Å–ª–∏ –∫–æ–Ω—Ç—É—Ä –Ω–µ –ø—Ä–æ—à—ë–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é (—Å–ª–∏—à–∫–æ–º –º–∞–ª, –∫–∞—Å–∞–µ—Ç—Å—è –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Ç.–¥.), –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ **–æ—Ç–±—Ä–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è**, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å –Ω–∞–¥–ø–∏—Å—å—é `"REJECTED: part of the preform outside the image"` –≤ `DEBUG_OUTPUT_FOLDER`.

2.  **–®–ê–ì 2: –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≥–ª–∞–≤–Ω–æ–π –æ—Å–∏**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `measurement.geometry.align_contour` (–Ω–∞ –æ—Å–Ω–æ–≤–µ PCA).
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—É—Ä, —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞, —Ü–µ–Ω—Ç—Ä –∏ –º–∞—Ç—Ä–∏—Ü—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.

3.  **–®–ê–ì 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –≥–æ—Ä–ª—ã—à–∫–∞**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `measurement.orientation.determine_neck_orientation`.
    ‚Üí **–ö–æ–Ω—Ç—É—Ä –Ω–µ –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è** ‚Äî –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –æ–±–ª–∞—Å—Ç–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥–Ω–∞.

4.  **–®–ê–ì 4: –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ (L, Z)**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `measurement.measuring_size.measure_gabarits`.
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –≤ –ø–∏–∫—Å–µ–ª—è—Ö –∏ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö.

5.  **–®–ê–ì 5: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–ª–æ—Ç–Ω–æ–≥–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `preprocessing.dense_contour.get_aligned_dense_contour` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—Ç—Ä–∏—Ü—ã –ø–æ–≤–æ—Ä–æ—Ç–∞.
    ‚Üí –ù—É–∂–µ–Ω –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥–∏–∞–º–µ—Ç—Ä–∞ –¥–Ω–∞ –∏ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç–∏.

6.  **–®–ê–ì 6: –ò–∑–º–µ—Ä–µ–Ω–∏–µ –¥–∏–∞–º–µ—Ç—Ä–∞ –¥–Ω–∞ (d1) —Å —É—á—ë—Ç–æ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `measurement.measuring_size.measure_bottom_diameter`.
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏–∞–º–µ—Ç—Ä –¥–Ω–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö –∏ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö.
    ‚Üí –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.

7.  **–®–ê–ì 7‚Äì9: –ó–∞–≥–ª—É—à–∫–∏**
    ‚Üí –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–æ—Ä–ª–æ–≤–∏–Ω—ã (`I`), –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Å—Ç—É–ø–æ–≤ ‚Äî **–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã**.

8.  **–®–ê–ì 10: –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç–∏ –æ—Å–∏ (S)**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `measurement.measuring_size.measure_straightness_deviation`.
    ‚Üí **–ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20% –¥–ª–∏–Ω—ã (–≥–æ—Ä–ª—ã—à–∫–æ)** –∏–∑ —Ä–∞—Å—á—ë—Ç–∞.
    ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:
        - `straightness_deviation_mm` ‚Äî **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (S_max)**,
        - `straightness_rms_mm` ‚Äî **—Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (S_rms)**.
    ‚Üí –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.

9.  **–®–ê–ì 11: –ó–∞–≥–ª—É—à–∫–∞**
    ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤ ‚Äî **–æ—Ç–ª–æ–∂–µ–Ω–∞**.

10. **–í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø**
    ‚Üí –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
        - `config.STEP_2_ALIGN_CONTOUR`: –≤—ã–∑—ã–≤–∞–µ—Ç `visualization.contour_alignment_viz.visualize_contour_alignment`.
        - `config.STEP_3_MEASURE_DIMENSIONS`: –≤—ã–∑—ã–≤–∞–µ—Ç `visualization.annotated_result_viz.visualize_dimensioned_drawing`.
        - `config.STEP_10_STRAIGHTNESS`: –≤—ã–∑—ã–≤–∞–µ—Ç `visualization.straightness_viz.visualize_straightness` ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∞–ø–ø—Ä–æ–∫—Å–∏–º–∏—Ä—É—é—â—É—é –ø—Ä—è–º—É—é, —Ü–µ–Ω—Ç—Ä—ã —Å–µ—á–µ–Ω–∏–π, —Ç–æ—á–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∏ –≥—Ä–∞–Ω–∏—Ü—É –≥–æ—Ä–ª—ã—à–∫–∞.

11. **–°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–ê**
    ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `utils.save_result_image`.
    ‚Üí –ò—Ç–æ–≥–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `OUTPUT_FOLDER`.

#### üìå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–±—Ä–∞–∫–æ–≤–∫–∏

*   –í–µ—Å—å –º–µ—Ç–æ–¥ –æ–±—ë—Ä–Ω—É—Ç –≤ `try-except`.
*   –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ:
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `("–û—à–∏–±–∫–∞", {}, [])`.
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –Ω–∞–¥–ø–∏—Å—å—é `"rejected: part of the preform outside the image"` (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º).
    - –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ª–æ–≥ —Å –ø–æ–ª–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π.
*   –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞:
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `("–û—Ç–±—Ä–∞–∫–æ–≤–∞–Ω–æ", {}, [])`.
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ `DEBUG_OUTPUT_FOLDER` —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–±—Ä–∞–∫–æ–≤–∫–∏.

#### üìå –¢–µ–∫—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–∞–±–∞—Ä–∏—Ç–æ–≤: **L, Z, d1**.
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç–∏: **S_max –∏ S_rms** —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –≥–æ—Ä–ª—ã—à–∫–∞.
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –¥–Ω–∞ –ø–æ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏.
- –ü–æ–ª–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —à–∞–≥–æ–≤.

‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –¥–æ–ø—É—Å–∫–∞–º –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** ‚Üí `verdict = "–í –ø—Ä–æ—Ü–µ—Å—Å–µ"`.
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –¥–∏–∞–º–µ—Ç—Ä–∞ –≥–æ—Ä–ª–æ–≤–∏–Ω—ã (`I`), –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Å—Ç—É–ø–æ–≤ –∏ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –æ—Ç–ª–æ–∂–µ–Ω—ã**.
- –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø—Ä–µ—Ñ–æ—Ä–º—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏** (–º—É–ª—å—Ç–∏-–¥–µ—Ç–µ–∫—Ü–∏—è ‚Äî –≤ –ø–ª–∞–Ω–∞—Ö).

---
